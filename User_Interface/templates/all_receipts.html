<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dashboard - Document Processing</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="/static/css/style.css" />
    <link rel="stylesheet" href="/static/css/dashboard.css" />
    <link rel="stylesheet" href="/static/css/receipt_modal.css" />
    <link rel="stylesheet" href="/static/css/all_receipts.css" />
    <link rel="icon" type="image/png" href="/static/images/sparko_logo_3.png" />

    <style>
      .export-btn:hover {
        background-color: #ffc107 !important;
        color: #000 !important;
      }
      .delete-btn:hover {
        background-color: #dc3545 !important;
        color: #fff !important;
      }
    </style>
  </head>
  <body class="min-vh-100 d-flex flex-column bg-black body-style">
    <div class="animated-bg position-fixed top-0 start-0 w-100 h-100">
      <div class="gradient"></div>
      <div class="blob blob1"></div>
      <div class="blob blob2"></div>
      <div class="blob blob3"></div>
      <div class="blob blob4"></div>
      <div class="grid"></div>
    </div>

    <main
      class="container-fluid dashboard-container py-5 position-relative flex-grow-1"
    >
      <div class="row justify-content-center min-vh-100 align-items-start py-3">
        <div
          class="col-12 main-container"
          style="margin-top: -35px; padding: 0px"
        >
          {% include 'navbar.html' %}
          <div class="container-scanner">
            <div class="row gy-4 gy-md-0 align-items-start row-padding">
              <div class="col-12">
                <div>
                  <div class="container-result">
                    <div
                      class="d-flex align-items-center justify-content-between mb-3"
                      style="position: relative"
                    >
                      <h2 class="processing-results-heading mb-0">
                        All Receipts
                      </h2>
                      <button
                        id="toggle-grouping"
                        class="btn btn-modern-group d-flex align-items-center px-3 py-2"
                        onclick="toggleGrouping()"
                        style="
                          border: none;
                          border-radius: 24px;
                          background: linear-gradient(
                            90deg,
                            #ffe082 0%,
                            #ffc107 60%,
                            #ff9800 100%
                          );
                          color: #222;
                          font-weight: 600;
                          box-shadow: 0 2px 8px rgba(255, 193, 7, 0.1);
                          transition: background 0.2s;
                          position: relative;
                          top: -2px;
                        "
                        onmouseover="this.style.background='linear-gradient(90deg, #ffc107 0%, #ff9800 100%)'; this.style.color='#fff';"
                        onmouseout="this.style.background='linear-gradient(90deg, #ffe082 0%, #ffc107 60%, #ff9800 100%)'; this.style.color='#222';"
                      >
                        <span class="me-2" style="font-size: 1.2em">üóÇÔ∏è</span>
                        <span id="grouping-label">Group by Store</span>
                      </button>
                    </div>

                    {% if receipts %}
                    <div id="receipts-container">
                      {% if grouped %} {% set store_groups = {} %} {% for
                      receipt in receipts %} {% set store =
                      receipt['store_name']|default('Unknown Store') %} {% if
                      store_groups[store] is not defined %} {% set _ =
                      store_groups.update({store: []}) %} {% endif %} {% set _ =
                      store_groups[store].append(receipt) %} {% endfor %} {% for
                      store in store_groups|dictsort %}
                      <div class="row g-4 mt-2">
                        <div class="col-12 d-flex align-items-center mb-3">
                          <div
                            class="store-icon me-2"
                            style="
                              background: transparent !important;
                              width: 65px;
                              height: 65px;
                              border: 2px solid white;
                              border-radius: 50%;
                              background: white;
                            "
                          >
                            <img
                              class="store-logo"
                              data-store-name="{{ store[0] }}"
                              onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';"
                              style="
                                padding: 15px;
                                height: 90px;
                                width: 90px;
                                object-fit: contain;
                                background: transparent;
                                border-radius: 50%;
                                background: white;
                              "
                            />
                            <span style="font-size: 24px; display: none"
                              >üè™</span
                            >
                          </div>
                          <h4
                            class="text-warning mb-0"
                            style="padding-left: 10px"
                          >
                            {{ store[0] }}
                          </h4>
                        </div>
                        <div class="col-12">
                          <div
                            style="
                              height: 5px;
                              width: 100%;
                              margin-bottom: 18px;
                              margin-top: -8px;
                              border-radius: 3px;
                              background: linear-gradient(
                                90deg,
                                #ffe082 0%,
                                #ffc107 50%,
                                #ff9800 100%
                              );
                              opacity: 0.7;
                            "
                          ></div>
                        </div>
                        {% for receipt in store[1] %}
                        <div class="col-12 col-lg-6 col-xl-3">
                          {% include 'receipt_card.html' with context %}
                        </div>
                        {% endfor %}
                      </div>
                      {% endfor %} {% else %}
                      <div class="row g-4 mt-2">
                        {% for receipt in receipts %}
                        <div class="col-12 col-lg-6 col-xl-3">
                          {% include 'receipt_card.html' with context %}
                        </div>
                        {% endfor %}
                      </div>
                      {% endif %}
                    </div>
                    {% else %}
                    <div class="no-receipts-message mt-5 text-center">
                      <div class="mb-4">
                        <span>üìÑ</span>
                      </div>
                      <h4 class="text-white mb-3">No Receipts Found</h4>
                      <p class="text-muted mb-4">
                        You haven't saved any receipts yet. Start by processing
                        a document on the dashboard.
                      </p>
                      <a href="/dashboard" class="btn btn-warning">
                        üìã Go to Dashboard
                      </a>
                    </div>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    {% include 'footer.html' %} {% include 'receipt_modal.htm' %}

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="/static/js/modal-utils.js"></script>
    <script src="/static/js/receipt-actions.js"></script>
    <script src="/static/js/color-extraction.js"></script>
    <script src="/static/js/store-logos.js"></script>
    <script src="/static/js/receipt_modal.js"></script>
    <script>
      function toggleGrouping() {
        const url = new URL(window.location.href);
        const grouped = url.searchParams.get("grouped") === "true";
        url.searchParams.set("grouped", !grouped);
        window.location.href = url.toString();
      }
      document.addEventListener("DOMContentLoaded", function () {
        const url = new URL(window.location.href);
        const grouped = url.searchParams.get("grouped") === "true";
        document.getElementById("grouping-label").textContent = grouped
          ? "Ungroup"
          : "Group by Store";
      });
    </script>
  </body>
</html>
